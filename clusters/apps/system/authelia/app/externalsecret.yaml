---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: authelia-secrets
  namespace: system
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: bitwarden
  target:
    name: authelia-secrets
    creationPolicy: Owner
    template:
      data:
        identity_validation.reset_password.jwt.hmac.key: "{{ index . \"identity_validation.reset_password.jwt.hmac.key\" }}"
        session.encryption.key: "{{ index . \"session.encryption.key\" }}"
        session.redis.password.txt: "{{ index . \"session.redis.password.txt\" }}"
        storage.encryption.key: "{{ index . \"storage.encryption.key\" }}"
        identity_providers.oidc.hmac.key: "{{ index . \"identity_providers.oidc.hmac.key\" }}"
        authentication.ldap.password.txt: "{{ index . \"authentication.ldap.password.txt\" }}"
  dataFrom:
    - extract:
        key: authelia-secrets
---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: authelia-redis-secret
  namespace: system
spec:

  secretStoreRef:
    kind: ClusterSecretStore
    name: bitwarden
  target:
    name: authelia-redis-secret
    creationPolicy: Owner
    template:
      data:
        password: "{{ .password }}"
  dataFrom:
    - extract:
        key: authelia-secrets
