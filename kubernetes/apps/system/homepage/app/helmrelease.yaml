# yaml-language-server: $schema=https://raw.githubusercontent.com/bjw-s-labs/helm-charts/app-template-4.5.0/charts/other/app-template/schemas/helmrelease-helm-v2.schema.json
---
# yaml-language-server: $schema=https://k8s-schemas.erwanleboucher.dev/helm.toolkit.fluxcd.io/helmrelease_v2.json
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: homepage
  namespace: system
spec:
  interval: 1h
  chartRef:
    kind: OCIRepository
    name: homepage
  values:
    controllers:
      homepage:
        type: deployment
        replicas: 1
        annotations:
          reloader.stakater.com/auto: "true"
        containers:
          app:
            image:
              repository: ghcr.io/gethomepage/homepage
              tag: latest
            env:
              - name: TZ
                value: "Europe/Paris"
              - name: HOMEPAGE_ALLOWED_HOSTS
                value: "*"
            envFrom:
              - secretRef:
                  name: homepage-secrets
            resources:
              requests:
                cpu: 50m
                memory: 128Mi
              limits:
                cpu: 500m
                memory: 512Mi
            probes:
              liveness:
                enabled: true
              readiness:
                enabled: true
              startup:
                enabled: true
                spec:
                  failureThreshold: 30
                  periodSeconds: 10
    service:
      app:
        controller: homepage
        ports:
          http:
            port: 3000
    route:
      app:
        parentRefs:
          - name: agentgateway-internal
            namespace: network
        hostnames:
          - dash.erwanleboucher.dev
    configMaps:
      config:
        data:
          docker.yaml: ""
          kubernetes.yaml: |
            mode: cluster
          bookmarks.yaml: |
            - Development:
              - GitHub:
                  - icon: github.png
                    href: https://github.com/erwanleboucher/mediaserver
                    description: Repository
              - Cloudflare:
                  - icon: cloudflare.png
                    href: https://dash.cloudflare.com/
                    description: DNS & Tunnel
              - Flux:
                  - icon: flux-cd.png
                    href: https://flux.erwanleboucher.dev
                    description: GitOps
              - Renovate:
                  - icon: renovate.png
                    href: https://renovate.erwanleboucher.dev
                    description: Dependency Updates
            - Tools:
              - BentoPDF:
                  - icon: bentopdf.png
                    href: https://pdf.erwanleboucher.dev
                    description: PDF Manager
              - Profilarr:
                  - icon: profilarr.png
                    href: https://profilarr.erwanleboucher.dev
                    description: Profile Manager
              - Qui:
                  - icon: qui.png
                    href: https://qui.erwanleboucher.dev
                    description: Download Manager
          settings.yaml: |
            title: Home Lab
            useEqualHeights: true
            color: zinc
            background:
              image: https://images.unsplash.com/photo-1544511916-0148ccdeb877?w=1920
              blur: md
              opacity: 30
            theme: dark
            statusStyle: dot
            disableCollapse: true
            headerStyle: clean
            cardBlur: md
            layout:
              Monitoring:
                style: row
                columns: 3
              Media:
                style: row
                columns: 3
              Downloads:
                style: row
                columns: 3
              Automation:
                style: row
                columns: 1
            providers:
              longhorn:
                url: http://longhorn-frontend.kube-system
          widgets.yaml: |
            - datetime:
                text_size: xl
                format:
                  dateStyle: long
                  timeStyle: short
            - openmeteo:
                label: Paris
                latitude: 48.8534
                longitude: 2.3488
                timezone: Europe/Paris
                units: metric
                cache: 5
            - openmeteo:
                label: Kharkiv
                latitude: 49.9808
                longitude: 36.2527
                timezone: Europe/Kiev
                units: metric
                cache: 5
            - kubernetes:
                cluster:
                  show: true
                  cpu: true
                  memory: true
                  showLabel: true
                  label: "cluster"
                nodes:
                  show: false
            - longhorn:
                expanded: false
                total: true
                labels: false
                nodes: false
          services.yaml: |
            - Monitoring:
              - Beszel:
                  icon: beszel.png
                  href: https://monitor.erwanleboucher.dev
                  description: Monitoring
                  widget:
                    type: beszel
                    url: http://beszel.monitoring:8090
                    username: '{{ "{{" }}HOMEPAGE_VAR_BESZEL_USER{{ "}}" }}'
                    password: '{{ "{{" }}HOMEPAGE_VAR_BESZEL_PASS{{ "}}" }}'
                    version: 2
              - Gatus:
                  icon: gatus.png
                  href: https://status.erwanleboucher.dev
                  description: Monitoring
                  widget:
                    type: gatus
                    url: http://gatus.monitoring
                    slug: default
              - Prometheus:
                  icon: prometheus.png
                  href: https://prometheus.erwanleboucher.dev
                  description: Metrics
                  widget:
                    type: prometheus
                    url: http://prometheus-operated.monitoring:9090
              - Grafana:
                  icon: grafana.png
                  href: https://grafana.erwanleboucher.dev
                  description: Dashboards
                  widget:
                    type: grafana
                    version: 2
                    url: http://grafana-service.monitoring:3000
                    username: '{{ "{{" }}HOMEPAGE_VAR_GRAFANA_USER{{ "}}" }}'
                    password: '{{ "{{" }}HOMEPAGE_VAR_GRAFANA_PASS{{ "}}" }}'
              - Mikrotik:
                  icon: mikrotik.png
                  href: https://router.erwanleboucher.dev
                  description: Router Management
                  widget:
                    type: mikrotik
                    url: https://192.168.1.2
                    username: '{{ "{{" }}HOMEPAGE_VAR_MIKROTIK_USER{{ "}}" }}'
                    password: '{{ "{{" }}HOMEPAGE_VAR_MIKROTIK_PASS{{ "}}" }}'
              - Cloudflared:
                  icon: cloudflare.png
                  href: https://one.dash.cloudflare.com/
                  description: Tunnel Status
                  widget:
                    type: cloudflared
                    accountid: '{{ "{{" }}HOMEPAGE_VAR_CF_ACCOUNT_ID{{ "}}" }}'
                    tunnelid: '{{ "{{" }}HOMEPAGE_VAR_CF_TUNNEL_ID{{ "}}" }}'
                    key: '{{ "{{" }}HOMEPAGE_VAR_CF_API_KEY{{ "}}" }}'
              - Alertmanager:
                  icon: alertmanager.png
                  href: https://alertmanager.erwanleboucher.dev
                  description: Alert Management

            - Media:
              - Jellyfin:
                  icon: jellyfin.png
                  href: https://watch.erwanleboucher.dev
                  description: Media Player
                  widget:
                    type: jellyfin
                    url: http://jellyfin.media:8096
                    key: '{{ "{{" }}HOMEPAGE_VAR_JELLYFIN_KEY{{ "}}" }}'
              - Jellyseerr:
                  icon: jellyseerr.png
                  href: https://request.erwanleboucher.dev
                  description: Request Media
                  widget:
                    type: jellyseerr
                    url: http://jellyseerr.media:5055
                    key: '{{ "{{" }}HOMEPAGE_VAR_JELLYSEERR_KEY{{ "}}" }}'
              - Sonarr:
                  icon: sonarr.png
                  href: https://sonarr.erwanleboucher.dev
                  description: TV Shows
                  widget:
                    type: sonarr
                    url: http://sonarr.media:8989
                    key: '{{ "{{" }}HOMEPAGE_VAR_SONARR_KEY{{ "}}" }}'
              - Radarr:
                  icon: radarr.png
                  href: https://radarr.erwanleboucher.dev
                  description: Movies
                  widget:
                    type: radarr
                    url: http://radarr.media:7878
                    key: '{{ "{{" }}HOMEPAGE_VAR_RADARR_KEY{{ "}}" }}'
              - Bazarr:
                  icon: bazarr.png
                  href: https://bazarr.erwanleboucher.dev
                  description: Subtitles
                  widget:
                    type: bazarr
                    url: http://bazarr.media:6767
                    key: '{{ "{{" }}HOMEPAGE_VAR_BAZARR_KEY{{ "}}" }}'
              - Prowlarr:
                  icon: prowlarr.png
                  href: https://prowlarr.erwanleboucher.dev
                  description: Indexer Manager
                  widget:
                    type: prowlarr
                    url: http://prowlarr.media:9696
                    key: '{{ "{{" }}HOMEPAGE_VAR_PROWLARR_KEY{{ "}}" }}'
              - Wizarr:
                  icon: wizarr.png
                  href: https://wizarr.erwanleboucher.dev
                  description: User Invitations
              - Streamystats:
                  icon: jellyfin.png
                  href: https://streamystats.erwanleboucher.dev
                  description: Jellyfin Statistics

            - Downloads:
              - SABnzbd:
                  icon: sabnzbd.png
                  href: https://sabnzbd.erwanleboucher.dev
                  description: NZB Downloader
                  widget:
                    type: sabnzbd
                    url: http://sabnzbd.downloads:8080
                    key: '{{ "{{" }}HOMEPAGE_VAR_SABNZBD_KEY{{ "}}" }}'
              - qBittorrent:
                  icon: qbittorrent.png
                  href: https://qbit.erwanleboucher.dev
                  description: Torrent Downloader
                  widget:
                    type: qbittorrent
                    url: http://qbittorrent.downloads:8080
                    username: '{{ "{{" }}HOMEPAGE_VAR_QBIT_USER{{ "}}" }}'
                    password: '{{ "{{" }}HOMEPAGE_VAR_QBIT_PASS{{ "}}" }}'
              - Autobrr:
                  icon: autobrr.png
                  href: https://autobrr.erwanleboucher.dev
                  description: Torrent Automation
                  widget:
                    type: autobrr
                    url: http://autobrr.downloads
                    key: '{{ "{{" }}HOMEPAGE_VAR_AUTOBRR_KEY{{ "}}" }}'
            - Automation:
              - Home Assistant:
                  icon: home-assistant.png
                  href: https://home.erwanleboucher.dev
                  description: Home Automation
                  widget:
                    type: homeassistant
                    url: http://home-assistant-external.system:8123
                    key: '{{ "{{" }}HOMEPAGE_VAR_HASS_KEY{{ "}}" }}'

    persistence:
      config:
        type: configMap
        name: homepage
        advancedMounts:
          homepage:
            app:
              - path: /app/config/bookmarks.yaml
                subPath: bookmarks.yaml
              - path: /app/config/docker.yaml
                subPath: docker.yaml
              - path: /app/config/kubernetes.yaml
                subPath: kubernetes.yaml
              - path: /app/config/services.yaml
                subPath: services.yaml
              - path: /app/config/settings.yaml
                subPath: settings.yaml
              - path: /app/config/widgets.yaml
                subPath: widgets.yaml
    serviceAccount:
      homepage: {}
